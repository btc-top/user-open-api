<!-- vscode-markdown-toc -->
* 1. [请求方式](#请求方式)
* 2. [安全要求](#安全要求)
* 3. [请求格式](#请求格式)
* 4. [授权机制](#授权机制)
    * 4.1. [client 端](#client-端)
    * 4.2. [server 端](#server-端)
    * 4.3. [举例](#举例)
* 5. [接口通用说明](#接口通用说明)
    * 5.1. [API 根地址：](#api-根地址：)
    * 5.2. [返回格式](#返回格式)
    * 5.3. [错误码说明](#错误码说明)
* 6. [接口定义](#接口定义)
    * 6.1. [收益](#收益)
        * 6.1.1. [获取用户出账记录。](#获取用户出账记录。)
        * 6.1.2. [获取用户历史付款记录。](#获取用户历史付款记录。)
        * 6.1.3. [获取用户当天实时挖矿收益（未包括网络手续费收益并且未扣除矿池费用）获取。](#获取用户当天实时挖矿收益（未包括网络手续费收益并且未扣除矿池费用）获取。)
    * 6.2. [算力](#算力)
        * 6.2.1. [获取用户当前实时算力信息。](#获取用户当前实时算力信息。)
        * 6.2.2. [获取用户最近 24 小时算力](#获取用户最近-24-小时算力)
        * 6.2.3. [获取用户最近 30 天日均算力](#获取用户最近-30-天日均算力)
        * 6.2.4. [批量获取用户所有矿机的小时算力信息](#批量获取用户所有矿机的小时算力信息)
    * 6.3. [矿机](#矿机)
        * 6.3.1. [获取用户当前矿机总体情况](#获取用户当前矿机总体情况)
        * 6.3.2. [获取用户矿机运行详情](#获取用户矿机运行详情)
        * 6.3.3. [获取用户矿机日在线数量](#获取用户矿机日在线数量)
    * 6.4. [设置](#设置)
        * 6.4.1. [获取用户收款设置](#获取用户收款设置)
        * 6.4.2. [获取用户所有子账户名](#获取用户所有子账户名)
        * 6.4.3. [生成用户的观察链接](#生成用户的观察链接)

<!-- vscode-markdown-toc-config
	numbering=true
	autoSave=true
	/vscode-markdown-toc-config -->
<!-- /vscode-markdown-toc -->[TOC]

##  1. <a name='请求方式'></a>请求方式

统一使用 HTTP 请求（基于 HTTP1.0/1.1 标准）的 GET 或 POST 方法。

##  2. <a name='安全要求'></a>安全要求

如果在公网则请求及响应数据采用 HTTPS 加密传输，内网可以使用 HTTP。

##  3. <a name='请求格式'></a>请求格式

数据采用 JSON 格式，请注意在 HTTP 请求的 header 中设置：`Content-Type: application/json`。

##  4. <a name='授权机制'></a>授权机制

###  4.1. <a name='client-端'></a>client 端

在 HTTP header 中添加 Authorization 字段，其值为根据颁发的 clientId 和 secretKey 生成的 jwt token 值。
其中 jwt token 的 playload 格式为：

| 字段     | 类型           | 描述                                                                                                        |
| -------- | -------------- | ----------------------------------------------------------------------------------------------------------- |
| clientId | string         | 从授权处获取的 clientId 编号                                                                                |
| rnd      | number         | 为了防止重放攻击使用的随机数，不得小于 8 位                                                                 |
| exp      | unix timestamp | 该 jwt token 的过期时间时间戳，建议比当前时间大 3 到 5 分钟，如果对安全要求高的可以缩小范围，不建议太大了。 |

###  4.2. <a name='server-端'></a>server 端

验证 client 端发送的 HTTP 请求中 header 里面的 Authorization 字段内容是否为合法授权的 jwt token。

###  4.3. <a name='举例'></a>举例

client 端发送一个请求给 server，并在其 http header 中加上有效的 jwt token：

```javascript
const _ = require('lodash');
const jwt = require('jsonwebtoken');
const request = require('request-promise-native');

const url = 'http://service_url'; // server端api的URL地址
const clientId = 'xxxxxxxxx';     // 授权处颁发的clientId
const secretKey = 'xxxxx';        // 授权处颁发的secretKey，注意保密

const random = _.random(1000000000, 9999999999);    // 随机数
const exp = Date.now() / 1000 + 180;                 // 有效期180秒
const playload = { clientId: clientId, rnd: random, exp: exp };    // jwt token的playload内容

const parameters = {}; // 接口请求参数内容

const token = jwt.sign(playload, secretKey);    // 产生授权jwt token

request.post(url, {
    headers: { Authorization: token },         // 在client的http header中设置Authorization字段，其值为前面产生的jwt token
    body: parameters,
    json: true,
}).then(function () {
    ......
});

```

##  5. <a name='接口通用说明'></a>接口通用说明

###  5.1. <a name='api-根地址：'></a>API 根地址：

`https://v2.btc.top/user-api`

###  5.2. <a name='返回格式'></a>返回格式

返回内容统一为 JSON 格式，包括的字段如下：

| 字段    | 类型   | 描述                                                   |
| ------- | ------ | ------------------------------------------------------ |
| code    | int    | 执行结果错误码，如果执行成功，为 0，否则为对应的错误码 |
| data    | any    | 接口返回数据内容                                       |
| message | string | 错误信息                                               |

###  5.3. <a name='错误码说明'></a>错误码说明

错误码对照表如下：

| 值   | 描述             |
| ---- | ---------------- |
| 0    | 执行成功         |
| 5010 | 输入内容无效     |
| 5020 | 用户身份验证失败 |
| 5030 | 操作失败         |
| 5040 | 权限不足         |
| 5050 | 系统错误         |

##  6. <a name='接口定义'></a>接口定义

###  6.1. <a name='收益'></a>收益

####  6.1.1. <a name='获取用户出账记录。'></a>获取用户出账记录。

方法: GET
接口路径: /profit/list

参数：

| 字段     | 是否必须 | 类型   | 描述                                                  |
| -------- | -------- | ------ | ----------------------------------------------------- |
| account  | 否       | string | 子账户用户名，如果不传表示只用当前 key 关联的默认账户 |
| coinType | string   | 是     | 收益币种，可选值为：btc、bch                          |
| startDay | string   | 是     | 开始日期，格式为：2020-02-29                          |
| endDay   | string   | 是     | 结束日期，格式为：2020-02-29                          |

返回值：

| 字段 | 类型  | 描述         |
| ---- | ----- | ------------ |
| data | array | 出账记录数组 |

出账记录格式：

| 字段  | 类型   | 描述       |
| ----- | ------ | ---------- |
| day   | date   | 出账日期   |
| total | double | 当天总收益 |
| netAvgFee | double | 当天网路手续费率 |
| profitPerP | double | 当天每P收益 |

举例：

```json
{
  "code": 0,
  "message": null,
  "data": [
    { "day": "2020-01-01", "total": 0.94418618, "netAvgFee": 0.0781, "profitPerP": 0.00123 },
    { "day": "2020-01-02", "total": 0.96527115, "netAvgFee": 0.0762, "profitPerP": 0.00113 },
    { "day": "2020-01-03", "total": 0.96356307, "netAvgFee": 0.0721, "profitPerP": 0.00133 }
  ]
}
```

####  6.1.2. <a name='获取用户历史付款记录。'></a>获取用户历史付款记录。

方法: GET
接口路径: /pay/list

参数：

| 字段     | 是否必须 | 类型   | 描述                                                  |
| -------- | -------- | ------ | ----------------------------------------------------- |
| account  | 否       | string | 子账户用户名，如果不传表示只用当前 key 关联的默认账户 |
| coinType | string   | 是     | 收益币种，可选值为：btc、bch                          |
| startDay | string   | 是     | 开始日期，格式为：2020-02-29                          |
| endDay   | string   | 是     | 结束日期，格式为：2020-02-29                          |

返回值：

| 字段 | 类型  | 描述         |
| ---- | ----- | ------------ |
| data | array | 付款记录数组 |

付款记录格式：

| 字段    | 类型   | 描述     |
| ------- | ------ | -------- |
| day     | date   | 出账日期 |
| amount  | double | 付款额   |
| address | string | 收款地址 |

举例：

```json
{
  "code": 0,
  "message": null,
  "data": [
    { "day": "2020-01-01", "total": 0.94418618, "address": "coin-address-xxxx" },
    { "day": "2020-01-02", "total": 0.96527115, "address": "coin-address-xxxx" },
    { "day": "2020-01-03", "total": 0.96356307, "address": "coin-address-xxxx" }
  ]
}
```

####  6.1.3. <a name='获取用户当天实时挖矿收益（未包括网络手续费收益并且未扣除矿池费用）获取。'></a>获取用户当天实时挖矿收益（未包括网络手续费收益并且未扣除矿池费用）获取。

方法: GET
接口路径: /profit/today

参数：

| 字段     | 是否必须 | 类型   | 描述                                                  |
| -------- | -------- | ------ | ----------------------------------------------------- |
| account  | 否       | string | 子账户用户名，如果不传表示只用当前 key 关联的默认账户 |
| coinType | string   | 是     | 收益币种，可选值为：btc、bch                          |

返回值：

| 字段 | 类型   | 描述     |
| ---- | ------ | -------- |
| data | object | 挖矿收益 |

挖矿收益格式：

| 字段  | 类型   | 描述   |
| ----- | ------ | ------ |
| total | double | 总收益 |

举例：

```json
{
  "code": 0,
  "message": null,
  "data": {
    "total": 0.28508561
  }
}
```

###  6.2. <a name='算力'></a>算力

####  6.2.1. <a name='获取用户当前实时算力信息。'></a>获取用户当前实时算力信息。

方法: GET
接口路径: /speed/realtime

参数：

| 字段    | 是否必须 | 类型   | 描述                                                  |
| ------- | -------- | ------ | ----------------------------------------------------- |
| account | 否       | string | 子账户用户名，如果不传表示只用当前 key 关联的默认账户 |

返回值：

| 字段 | 类型   | 描述         |
| ---- | ------ | ------------ |
| data | object | 实时算力信息 |

实时算力信息格式：

| 字段     | 类型   | 描述        |
| -------- | ------ | ----------- |
| speed5m  | object | 5 分钟算力  |
| speed10m | object | 10 分钟算力 |
| speed30m | object | 30 分钟算力 |

算力格式：

| 字段       | 类型  | 描述          |
| ---------- | ----- | ------------- |
| validSpeed | int   | 有效算力(H/s) |
| rejectRate | float | 拒绝率        |

举例：

```json
{
  "code": 0,
  "message": null,
  "data": {
    "speed5m": { "validSpeed": 24561271905291252, "rejectRate": 0.007 },
    "speed10m": { "validSpeed": 24388516638335084, "rejectRate": 0.001 },
    "speed30m": { "validSpeed": 24559043561725624, "rejectRate": 0 }
  }
}
```

####  6.2.2. <a name='获取用户最近-24-小时算力'></a>获取用户最近 24 小时算力

方法: GET
接口路径: /speed/hourly/24h

参数：

| 字段    | 是否必须 | 类型   | 描述                                                  |
| ------- | -------- | ------ | ----------------------------------------------------- |
| account | 否       | string | 子账户用户名，如果不传表示只用当前 key 关联的默认账户 |

返回值：

| 字段 | 类型  | 描述             |
| ---- | ----- | ---------------- |
| data | array | 小时算力信息数组 |

小时算力信息格式：

| 字段       | 类型     | 描述          |
| ---------- | -------- | ------------- |
| at         | datetime | 时间(小时)    |
| validSpeed | int      | 有效算力(H/s) |
| rejectRate | float    | 拒绝率        |

举例：

```json
{
  "code": 0,
  "message": null,
  "data": [
    { "at": "2020-01-01 08:00:00", "validSpeed": 24561271905291252, "rejectRate": 0.007 },
    { "at": "2020-01-01 09:00:00", "validSpeed": 24388516638335084, "rejectRate": 0.001 },
    { "at": "2020-01-01 10:00:00", "validSpeed": 24559043561725624, "rejectRate": 0 },
    { "at": "2020-01-01 11:00:00", "validSpeed": 24388516638335084, "rejectRate": 0.001 },
    { "at": "2020-01-01 12:00:00", "validSpeed": 24559043561725624, "rejectRate": 0 },
    { "at": "2020-01-01 13:00:00", "validSpeed": 24388516638335084, "rejectRate": 0.001 },
    { "at": "2020-01-01 14:00:00", "validSpeed": 24559043561725624, "rejectRate": 0 },
    { "at": "2020-01-01 15:00:00", "validSpeed": 24388516638335084, "rejectRate": 0.001 },
    { "at": "2020-01-01 16:00:00", "validSpeed": 24559043561725624, "rejectRate": 0 }
  ]
}
```

####  6.2.3. <a name='获取用户最近-30-天日均算力'></a>获取用户最近 30 天日均算力

方法: GET
接口路径: /speed/daily/30d

参数：

| 字段    | 是否必须 | 类型   | 描述                                                  |
| ------- | -------- | ------ | ----------------------------------------------------- |
| account | 否       | string | 子账户用户名，如果不传表示只用当前 key 关联的默认账户 |

返回值：

| 字段 | 类型  | 描述             |
| ---- | ----- | ---------------- |
| data | array | 日均算力信息数组 |

日均算力信息格式：

| 字段       | 类型  | 描述                                                               |
| ---------- | ----- | ------------------------------------------------------------------ |
| at         | date  | 时间(天)，注意一天的起止时间是：北京时间的早 8 点到第二天早 8 点。 |
| validSpeed | int   | 有效算力(H/s)                                                      |
| rejectRate | float | 拒绝率                                                             |

举例：

```json
{
  "code": 0,
  "message": null,
  "data": [
    { "at": "2020-01-01", "validSpeed": 24561271905291252, "rejectRate": 0.007 },
    { "at": "2020-01-02", "validSpeed": 24388516638335084, "rejectRate": 0.001 },
    { "at": "2020-01-03", "validSpeed": 24559043561725624, "rejectRate": 0 },
    { "at": "2020-01-04", "validSpeed": 24388516638335084, "rejectRate": 0.001 },
    { "at": "2020-01-05", "validSpeed": 24559043561725624, "rejectRate": 0 },
    { "at": "2020-01-06", "validSpeed": 24388516638335084, "rejectRate": 0.001 },
    { "at": "2020-01-07", "validSpeed": 24559043561725624, "rejectRate": 0 },
    { "at": "2020-01-08", "validSpeed": 24388516638335084, "rejectRate": 0.001 },
    { "at": "2020-01-09", "validSpeed": 24559043561725624, "rejectRate": 0 }
  ]
}
```

####  6.2.4. <a name='批量获取用户所有矿机的小时算力信息'></a>批量获取用户所有矿机的小时算力信息

方法: GET
接口路径: /speed/user-workers/hourly

参数:

| 字段    | 是否必须 | 类型     | 描述                                                  |
| ------- | -------- | -------- | ----------------------------------------------------- |
| account | 否       | string   | 子账户用户名，如果不传表示只用当前 key 关联的默认账户 |
| start   | 是       | datetime | 开始时间                                              |
| end     | 是       | datetime | 截止时间                                              |

返回值:

| 字段 | 类型  | 描述         |
| ---- | ----- | ------------ |
| data | array | 小时算力信息 |

小时算力信息:

| 字段       | 类型   | 描述       |
| ---------- | ------ | ---------- |
| worker     | string | 矿机名     |
| at         | string | 时间(小时) |
| validSpeed | int    | 算力       |
| rejectRate | double | 拒绝率     |

举例:

```json
{
  "code": 0,
  "message": null,
  "data": [
    {
      "worker": "100x001",
      "at": "2020-04-01 00:00:00",
      "validSpeed": 11234342234231434,
      "rejectSpeed": 0.00123
    },
    {
      "worker": "100x002",
      "at": "2020-04-01 01:00:00",
      "validSpeed": 11234342234231424,
      "rejectRate": 0.00122
    }
  ]
}
```

###  6.3. <a name='矿机'></a>矿机

####  6.3.1. <a name='获取用户当前矿机总体情况'></a>获取用户当前矿机总体情况

方法: GET
接口路径: /worker/summary

参数：

| 字段    | 是否必须 | 类型   | 描述                                                  |
| ------- | -------- | ------ | ----------------------------------------------------- |
| account | 否       | string | 子账户用户名，如果不传表示只用当前 key 关联的默认账户 |

返回值：

| 字段 | 类型   | 描述         |
| ---- | ------ | ------------ |
| data | object | 矿机总体情况 |

矿机总体情况格式：

| 字段    | 类型 | 描述             |
| ------- | ---- | ---------------- |
| running | int  | 运行中矿机数量。 |
| stopped | int  | 停机矿机数量     |
| invalid | int  | 失效矿机数量     |

举例：

```json
{
  "code": 0,
  "message": null,
  "data": {
    "running": 12,
    "stopped": 1,
    "invalid": 0
  }
}
```

####  6.3.2. <a name='获取用户矿机运行详情'></a>获取用户矿机运行详情

方法: GET
接口路径: /worker/list

参数：

| 字段    | 是否必须 | 类型   | 描述                                                  |
| ------- | -------- | ------ | ----------------------------------------------------- |
| account | 否       | string | 子账户用户名，如果不传表示只用当前 key 关联的默认账户 |

返回值：

| 字段 | 类型  | 描述             |
| ---- | ----- | ---------------- |
| data | array | 矿机运行详细信息 |

矿机详细信息格式：

| 字段     | 类型   | 描述                         |
| -------- | ------ | ---------------------------- |
| name     | string | 矿机名称                     |
| speed5m  | object | 5 分钟算力                   |
| speed30m | object | 30 分钟算力                  |
| speed24h | object | 24 小时算力                  |
| status   | int    | 状态: 1-在线, 2-停机, 3-失效 |

算力格式：

| 字段       | 类型  | 描述          |
| ---------- | ----- | ------------- |
| validSpeed | int   | 有效算力(H/s) |
| rejectRate | float | 拒绝率        |

举例：

```json
{
  "code": 0,
  "message": null,
  "data": [
    {
      "name": "4x18x88",
      "speed5m": { "validSpeed": 24561271905291252, "rejectRate": 0.007 },
      "speed30m": { "validSpeed": 24388516638335084, "rejectRate": 0.001 },
      "speed24h": { "validSpeed": 24559043561725624, "rejectRate": 0.001 },
      "status": 1
    },
    {
      "name": "4x18x89",
      "speed5m": { "validSpeed": 24561271905291252, "rejectRate": 0.007 },
      "speed30m": { "validSpeed": 24388516638335084, "rejectRate": 0.001 },
      "speed24h": { "validSpeed": 24559043561725624, "rejectRate": 0.001 },
      "status": 1
    },
    {
      "name": "4x18x90",
      "speed5m": { "validSpeed": 0, "rejectRate": 0 },
      "speed30m": { "validSpeed": 24388516638335084, "rejectRate": 0.001 },
      "speed24h": { "validSpeed": 24559043561725624, "rejectRate": 0.001 },
      "status": 2
    }
  ]
}
```

####  6.3.3. <a name='获取用户矿机日在线数量'></a>获取用户矿机日在线数量

方法: GET
接口路径: /worker/online-num/daily

参数：

| 字段    | 是否必须 | 类型   | 描述                                                  |
| ------- | -------- | ------ | ----------------------------------------------------- |
| account | 否       | string | 子账户用户名，如果不传表示只用当前 key 关联的默认账户 |

返回值：

| 字段 | 类型  | 描述             |
| ---- | ----- | ---------------- |
| data | array | 矿机日在线数量信息 |

矿机日在线数量信息：

| 字段     | 类型   | 描述                         |
| -------- | ------ | ---------------------------- |
| at        | string | 日期  |
| workerNum | int    | 在线矿机数量 |


举例：

```json
{
  "code": 0,
  "message": null,
  "data": [
    {
      "at": "2020-04-01",
      "workerNum": 100
    },
    {
      "at": "2020-04-01",
      "workerNum": 100
    }
  ]
}
```

###  6.4. <a name='设置'></a>设置

####  6.4.1. <a name='获取用户收款设置'></a>获取用户收款设置

方法: GET
接口路径: /account/pay-setting

参数：

| 字段     | 是否必须 | 类型   | 描述                                                  |
| -------- | -------- | ------ | ----------------------------------------------------- |
| account  | 否       | string | 子账户用户名，如果不传表示只用当前 key 关联的默认账户 |
| coinType | string   | 是     | 收益币种，可选值为：btc、bch                          |

返回值：

| 字段 | 类型   | 描述         |
| ---- | ------ | ------------ |
| data | object | 用户收款设置 |

用户收款设置格式：

| 字段    | 类型   | 描述                               |
| ------- | ------ | ---------------------------------- |
| address | string | 收币地址                           |
| min     | float  | 自动收币最小额度，0 表示不自动收币 |

举例：

```json
{
  "code": 0,
  "message": null,
  "data": {
    "address": "coin-address-xxxxx",
    "min": 0.001
  }
}
```

####  6.4.2. <a name='获取用户所有子账户名'></a>获取用户所有子账户名

方法: GET
接口路径: /account/sub-account/list

参数：

| 字段    | 是否必须 | 类型   | 描述                                                  |
| ------- | -------- | ------ | ----------------------------------------------------- |
| account | 否       | string | 子账户用户名，如果不传表示只用当前 key 关联的默认账户 |

返回值：

| 字段 | 类型     | 描述         |
| ---- | -------- | ------------ |
| data | string[] | 子账户名数组 |

举例：

```json
{
  "code": 0,
  "message": null,
  "data": ["account1", "account2", "account3"]
}
```

####  6.4.3. <a name='生成用户的观察链接'></a>生成用户的观察链接

方法: POST
接口路径: /observer/create

参数：

| 字段    | 是否必须 | 类型     | 描述                                                                                              |
| ------- | -------- | -------- | ------------------------------------------------------------------------------------------------- |
| account | 否       | string   | 子账户用户名，如果不传表示只用当前 key 关联的默认账户                                             |
| rights  | 是       | string[] | 观察者具备的权限项数组，目前包括 3 个权限项：dashboard_observer、worker_observer、profit_observer |
| remark  | 否       | string   | 观察者备注                                                                                        |

返回值：

| 字段 | 类型 | 描述         |
| ---- | ---- | ------------ |
| data | bool | 操作是否成功 |

举例：

```json
{
  "code": 0,
  "message": null,
  "data": true
}
```
